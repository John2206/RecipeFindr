<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Finder</title>
</head>
<body>
    <h1>Recipe Finder</h1>

    <!-- Input for asking AI -->
    <input type="text" id="recipePrompt" placeholder="Ask AI for a recipe..." />
    <button onclick="askAI()">Ask AI</button>

    <!-- Display AI Response -->
    <div id="aiResponse">AI Response will be displayed here...</div>

    <!-- Display Recipe Suggestions -->
    <ul id="recipeSuggestions"></ul> <!-- Recipes will be listed here -->

    <!-- Ingredient List -->
    <h2>Ingredients</h2>
    <input type="text" id="ingredientInput" placeholder="Add an ingredient" />
    <button onclick="addIngredient()">Add Ingredient</button>
    <ul id="ingredientList"></ul>

    <!-- Recipe Search -->
    <h2>Search Recipes</h2>
    <button onclick="searchRecipes()">Search Recipes</button>

    <script>
        const API_URL = "http://localhost:5003"; // Update this to match your backend's URL

        let currentPage = 1;

        // Function to add an ingredient to the list
        function addIngredient() {
            const input = document.getElementById("ingredientInput");
            const list = document.getElementById("ingredientList");
            const ingredient = input.value.trim();

            if (ingredient) {
                const listItem = document.createElement("li");
                listItem.textContent = ingredient;

                // Create delete button
                const deleteButton = document.createElement("button");
                deleteButton.textContent = "❌";
                deleteButton.onclick = () => listItem.remove();

                listItem.appendChild(deleteButton);
                list.appendChild(listItem);
                input.value = "";
            }
        }

        // Function to get all ingredients from the list
        function getIngredients() {
            return Array.from(document.querySelectorAll("#ingredientList li"))
                .map(item => item.textContent.replace("❌", "").trim())
                .filter(ingredient => ingredient); // Filter out empty ingredients
        }

        // Function to search recipes by ingredient
        async function searchRecipes() {
            const ingredients = getIngredients();
            console.log('Ingredients:', ingredients); // Debugging
            if (ingredients.length === 0) {
                alert("Please add some ingredients first!");
                return;
            }

            try {
                const response = await fetch(`${API_URL}/recipes/search?ingredient=${ingredients.join(",")}&limit=10&page=${currentPage}`);
                const recipes = await response.json();
                console.log('Recipes:', recipes);  // Debugging

                const resultsList = document.getElementById("recipeSuggestions");
                resultsList.innerHTML = ""; // Clear previous results

                if (recipes.length === 0) {
                    resultsList.innerHTML = "<li>No recipes found with these ingredients.</li>";
                    return;
                }

                recipes.forEach(recipe => {
                    const recipeItem = document.createElement("li");
                    recipeItem.innerHTML = `
                        <strong>${recipe.name}</strong><br>
                        Ingredients: ${recipe.ingredients}<br>
                        Instructions: ${recipe.instructions}<br>
                        <hr>
                    `;
                    resultsList.appendChild(recipeItem);
                });

                // Add button to load more recipes
                const loadMoreButton = document.createElement("button");
                loadMoreButton.textContent = "Find Other Recipes Using These Ingredients";
                loadMoreButton.onclick = loadMoreRecipes;
                resultsList.appendChild(loadMoreButton);

            } catch (error) {
                console.error("Error fetching recipes:", error);
            }
        }

        // Function to load more recipes
        async function loadMoreRecipes() {
            currentPage++; // Increase the page number
            searchRecipes(); // Fetch the next set of recipes
        }

        // Function to ask AI for a recipe suggestion
        async function askAI() {
            const prompt = document.getElementById("recipePrompt").value.trim();
            const responseBox = document.getElementById("aiResponse");

            if (!prompt) {
                alert("Enter a question for AI!");
                return;
            }

            responseBox.innerText = "Thinking... 🤔";

            try {
                const response = await fetch(`${API_URL}/ask-ai`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ prompt }),
                });

                const data = await response.json();
                if (data.response) {
                    responseBox.innerText = data.response;  // Display AI response here
                    displayRecipeSuggestions(data.response); // Function to display recipes
                } else {
                    responseBox.innerText = "No response.";
                }
            } catch (error) {
                responseBox.innerText = `Error getting AI response: ${error.message}`;
            }
        }

        // Function to display AI recipe suggestions
        function displayRecipeSuggestions(aiResponse) {
            const recipeSuggestionsContainer = document.getElementById("recipeSuggestions");
            
            // Clear any previous suggestions
            recipeSuggestionsContainer.innerHTML = "";

            // Assuming AI response contains a list of recipe suggestions or formatted text
            const recipes = aiResponse.split("\n");  // Adjust depending on how the AI response is formatted

            recipes.forEach(recipe => {
                const recipeItem = document.createElement("li");
                recipeItem.textContent = recipe;
                recipeSuggestionsContainer.appendChild(recipeItem);
            });
        }
    </script>
</body>
</html>

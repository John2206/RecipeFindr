<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Details - RecipeFindr</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="recipes.html">Recipes</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="login.html">Login</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="recipe-details">
            <div class="recipe-header">
                <h1 id="recipeTitle">Loading Recipe...</h1>
                <div class="recipe-meta">
                    <span id="recipeTime">Time: --</span>
                    <span id="recipeServings">Servings: --</span>
                    <span id="recipeDifficulty">Difficulty: --</span>
                </div>
            </div>

            <div class="recipe-content">
                <div class="recipe-image-container">
                    <img id="recipeImage" src="placeholder.jpg" alt="Recipe Image" onerror="this.src='fallback-image.jpg'">
                </div>

                <div class="recipe-info">
                    <div class="ingredients-section">
                        <h2>Ingredients</h2>
                        <ul id="ingredientsList"></ul>
                    </div>

                    <div class="instructions-section">
                        <h2>Instructions</h2>
                        <ol id="instructionsList"></ol>
                    </div>

                    <div class="nutrition-section">
                        <h2>Nutrition Information</h2>
                        <div id="nutritionInfo" class="nutrition-info">
                            <p>Calories: --</p>
                            <p>Protein: --</p>
                            <p>Carbs: --</p>
                            <p>Fat: --</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="recipe-actions">
                <button onclick="window.location.href='recipes.html'" class="back-btn">Back to Recipes</button>
                <button onclick="printRecipe()" class="print-btn">Print Recipe</button>
            </div>
        </section>

        <section class="results-section">
            <div id="recipeResults">
                <h2>Suggested Recipes</h2>
                <div class="recipes-grid" id="recipesList">
                    <!-- Recipe cards will be dynamically added here -->
                </div>
                <div class="button-group">
                    <button onclick="searchRecipes()" class="btn btn-primary">Get Recipes</button>
                    <button onclick="findOtherRecipes()" class="btn btn-secondary">Find Similar Recipes</button>
                    <button class="btn btn-danger" onclick="deleteAllIngredients()">Clear All</button>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>RecipeFindr</h3>
                <p>Your ultimate recipe discovery platform</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="recipes.html">Recipes</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li>
    </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 RecipeFindr. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        // Get recipe ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const recipeId = urlParams.get('id');

        // Function to show error message
        function showError(message) {
            document.getElementById('recipeTitle').textContent = message;
            document.getElementById('recipeTitle').classList.add('error-message');
        }

        // Function to fetch and display recipe details
        async function fetchRecipeDetails() {
            try {
                if (!recipeId) {
                    throw new Error('No recipe ID provided');
                }

                const response = await fetch(`/api/recipes/${recipeId}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const recipe = await response.json();

                // Update the page with recipe details
                document.getElementById('recipeTitle').textContent = recipe.title;
                document.getElementById('recipeTime').textContent = `Time: ${recipe.readyInMinutes} minutes`;
                document.getElementById('recipeServings').textContent = `Servings: ${recipe.servings}`;
                document.getElementById('recipeDifficulty').textContent = `Difficulty: ${recipe.difficulty || 'Medium'}`;
                
                // Set recipe image with fallback
                const recipeImage = document.getElementById('recipeImage');
                recipeImage.src = recipe.image || 'fallback-image.jpg';
                recipeImage.alt = recipe.title;

                // Populate ingredients list
                const ingredientsList = document.getElementById('ingredientsList');
                ingredientsList.innerHTML = ''; // Clear existing content
                if (recipe.extendedIngredients && recipe.extendedIngredients.length > 0) {
                    recipe.extendedIngredients.forEach(ingredient => {
                        const li = document.createElement('li');
                        li.textContent = `${ingredient.amount} ${ingredient.unit} ${ingredient.name}`;
                        ingredientsList.appendChild(li);
                    });
                } else {
                    ingredientsList.innerHTML = '<li>No ingredients information available</li>';
                }

                // Populate instructions
                const instructionsList = document.getElementById('instructionsList');
                instructionsList.innerHTML = ''; // Clear existing content
                if (recipe.analyzedInstructions && recipe.analyzedInstructions[0]?.steps) {
                    recipe.analyzedInstructions[0].steps.forEach(step => {
                        const li = document.createElement('li');
                        li.textContent = step.step;
                        instructionsList.appendChild(li);
                    });
                } else {
                    instructionsList.innerHTML = '<li>No instructions available</li>';
                }

                // Populate nutrition information
                const nutritionInfo = document.getElementById('nutritionInfo');
                if (recipe.nutrition) {
                    const nutritionHtml = `
                        <p>Calories: ${recipe.nutrition.calories || '--'}</p>
                        <p>Protein: ${recipe.nutrition.protein || '--'}g</p>
                        <p>Carbs: ${recipe.nutrition.carbs || '--'}g</p>
                        <p>Fat: ${recipe.nutrition.fat || '--'}g</p>
                    `;
                    nutritionInfo.innerHTML = nutritionHtml;
                }

            } catch (error) {
                console.error('Error fetching recipe details:', error);
                showError('Error loading recipe. Please try again later.');
            }
        }

        // Function to print recipe
        function printRecipe() {
            const printWindow = window.open('', '_blank');
            const recipeTitle = document.getElementById('recipeTitle').textContent;
            const recipeContent = document.querySelector('.recipe-content').innerHTML;
            
            printWindow.document.write(`
                <html>
                    <head>
                        <title>${recipeTitle} - RecipeFindr</title>
                        <style>
                            body { font-family: Arial, sans-serif; }
                            .recipe-image-container { max-width: 500px; margin: 0 auto; }
                            .recipe-image-container img { width: 100%; }
                            .recipe-info { margin-top: 20px; }
                            h2 { color: #333; }
                            @media print {
                                .recipe-actions { display: none; }
                            }
                        </style>
                    </head>
                    <body>
                        <h1>${recipeTitle}</h1>
                        ${recipeContent}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Fetch recipe details when page loads
        fetchRecipeDetails();
    </script>
</body>
</html>
